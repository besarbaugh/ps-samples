# Define the path for the reorganized exceptions JSON file
$newExceptionsPath = ".\exceptions_reorganized.json"

# Load the existing exceptions file
if (-not (Test-Path -Path $newExceptionsPath)) {
    Write-Host "Error: The exceptions_reorganized.json file was not found at $newExceptionsPath"
    exit
}

$exceptions = Get-Content -Path $newExceptionsPath | ConvertFrom-Json

# Process each exception in SecArchExceptions and ActionPlanExceptions, adding a unique GUID if missing
foreach ($exception in $exceptions.SecArchExceptions) {
    if (-not $exception.PSObject.Properties["uniqueID"]) {
        $exception | Add-Member -MemberType NoteProperty -Name "uniqueID" -Value (New-Guid).Guid
    }
}

foreach ($exception in $exceptions.ActionPlanExceptions) {
    if (-not $exception.PSObject.Properties["uniqueID"]) {
        $exception | Add-Member -MemberType NoteProperty -Name "uniqueID" -Value (New-Guid).Guid
    }
}

# Save the updated structure back to the JSON file
$exceptions | ConvertTo-Json -Depth 10 | Set-Content -Path $newExceptionsPath

Write-Host "Unique GUIDs added to each exception in $newExceptionsPath"
