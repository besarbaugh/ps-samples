# Define paths for the old and new exceptions JSON files
$exceptionsPath = ".\exceptions.json"
$newExceptionsPath = ".\exceptions_reorganized.json"

# Load the existing exceptions.json
if (-not (Test-Path -Path $exceptionsPath)) {
    Write-Host "Error: The exceptions.json file was not found at $exceptionsPath"
    exit
}

$exceptions = Get-Content -Path $exceptionsPath | ConvertFrom-Json

# Initialize the new JSON structure with separate groups
$newExceptions = @{
    SecArchExceptions = @()
    ActionPlanExceptions = @()
}

# Process each exception entry
foreach ($exception in $exceptions) {
    # Check if the exception is a SecArch exception
    if ($exception.SecArch) {
        # Add to SecArchExceptions group
        $newExceptions.SecArchExceptions += $exception
    }
    # Check if the exception is an ActionPlan exception
    elseif ($exception.ActionPlan) {
        # Add to ActionPlanExceptions group
        $newExceptions.ActionPlanExceptions += $exception
    }
    else {
        Write-Host "Warning: Exception does not have SecArch or ActionPlan. Skipping."
    }
}

# Convert the new structure to JSON and save it
$newExceptions | ConvertTo-Json -Depth 10 | Set-Content -Path $newExceptionsPath

Write-Host "Conversion completed. New file saved at $newExceptionsPath"
